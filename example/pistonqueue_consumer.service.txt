[Unit]
Description=Hybrid Ruby Worker Service
After=network.target redis-server.service

[Service]
User=blackedet
# Set WorkingDirectory agar systemd tahu di mana harus mencari Gemfile dan skrip
WorkingDirectory=/home/blackedet/MyWorks/pistonqueue/example
Environment="REDIS_URL=redis://localhost:6379"
Environment="POOL_SIZE=20"
# Gunakan bundle exec yang benar, dengan jalur lengkap ke executable
ExecStartPre=/home/blackedet/.local/share/mise/installs/ruby/3.4.5/bin/bundle install
ExecStart=/home/blackedet/.local/share/mise/installs/ruby/3.4.5/bin/bundle exec /home/blackedet/.local/share/mise/installs/ruby/3.4.5/bin/ruby consumer.rb
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target